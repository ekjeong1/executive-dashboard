<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>대표님 통합 대시보드</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
    .container{max-width:1200px;margin:0 auto}
    .header{background:#fff;border-radius:15px;padding:25px;margin-bottom:25px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
    .header h1{font-size:28px;color:#333;margin-bottom:10px}
    .status-bar{display:flex;gap:20px;align-items:center;flex-wrap:wrap}
    .status-item{display:flex;align-items:center;gap:8px;padding:8px 15px;background:#f0f0f0;border-radius:20px;font-size:14px}
    .status-dot{width:8px;height:8px;background:#4ade80;border-radius:50%;animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
    .main-grid{display:grid;grid-template-columns:2fr 1fr;gap:25px}
    @media(max-width:1024px){.main-grid{grid-template-columns:1fr}}
    .card{background:#fff;border-radius:15px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
    .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid #f0f0f0}
    .card-title{font-size:20px;font-weight:600;color:#333}
    .badge{padding:5px 12px;background:#667eea;color:#fff;border-radius:15px;font-size:12px;font-weight:600}
    .urgent-panel{background:linear-gradient(135deg,#f59e0b 0%,#ea580c 100%);color:#fff;border-radius:15px;padding:20px;margin-bottom:25px}
    .request-types{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:15px}
    .request-type-btn{padding:10px;background:rgba(255,255,255,.2);border:2px solid transparent;border-radius:10px;color:#fff;font-weight:600;cursor:pointer;transition:.3s}
    .request-type-btn.active{background:rgba(255,255,255,.3);border-color:#fff}
    .message-input{width:100%;padding:15px;border:none;border-radius:10px;font-size:16px;margin-bottom:15px;resize:vertical;min-height:100px}
    .action-buttons{display:flex;gap:10px}
    .btn{padding:12px 25px;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:.3s;display:flex;align-items:center;gap:8px}
    .btn-send{background:#fff;color:#ea580c}
    .btn-send:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,.2)}
    .meeting-list{max-height:400px;overflow-y:auto}
    .meeting-item{padding:15px;background:#f8f9fa;border-radius:10px;margin-bottom:10px;border-left:4px solid #667eea;transition:.3s}
    .meeting-item:hover{transform:translateX(5px);box-shadow:0 3px 10px rgba(0,0,0,.1)}
    .meeting-time{font-size:14px;font-weight:600;color:#666;margin-bottom:5px}
    .meeting-title{font-size:16px;font-weight:600;color:#333;margin-bottom:5px}
    .meeting-detail{font-size:13px;color:#666}
    .chat-container{height:300px;overflow-y:auto;padding:15px;background:#f8f9fa;border-radius:10px;margin-bottom:15px}
    .chat-message{margin-bottom:15px;padding:10px;background:#fff;border-radius:10px}
    .chat-message.sent{background:#667eea;color:#fff;margin-left:20%}
    .chat-message.received{margin-right:20%}
    .chat-time{font-size:11px;opacity:.7;margin-top:5px}
    .chat-input-group{display:flex;gap:10px}
    .chat-input{flex:1;padding:10px;border:1px solid #ddd;border-radius:10px;font-size:14px}
    .file-upload-area{border:2px dashed #ddd;border-radius:10px;padding:20px;text-align:center;cursor:pointer;transition:.3s}
    .file-upload-area:hover{border-color:#667eea;background:#f8f9fa}
    .file-list{margin-top:15px;max-height:200px;overflow-y:auto}
    .file-item{display:flex;align-items:center;gap:10px;padding:8px;background:#f8f9fa;border-radius:8px;margin-bottom:8px}
    .request-list{max-height:300px;overflow-y:auto}
    .request-item{padding:12px;background:#f8f9fa;border-radius:10px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
    .request-status{padding:5px 10px;border-radius:5px;font-size:12px;font-weight:600}
    .status-open{background:#fef3c7;color:#d97706}
    .status-doing{background:#dbeafe;color:#2563eb}
    .status-done{background:#d1fae5;color:#059669}
    .meeting-item.completed{opacity:.6;background:#e8e8e8}
    .meeting-item.ongoing{background:#fff8e1;border-left-color:#ff9800;animation:pulse-border 2s infinite}
    @keyframes pulse-border{0%,100%{border-left-width:4px}50%{border-left-width:6px}}
    .meeting-item.upcoming{background:#e8f5e9;border-left-color:#4caf50}
    .chat-message.schedule-request{background:#fff3e0!important;color:#333!important;border:1px solid #ff9800}
    .toast{position:fixed;top:20px;right:20px;padding:15px 20px;background:#fff;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.2);display:none;animation:slideIn .3s ease}
    @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
    .toast.show{display:flex;align-items:center;gap:10px}
    .loading{display:inline-block;width:20px;height:20px;border:3px solid #f3f3f3;border-top:3px solid #667eea;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>📊 통합 대시보드</h1>
      <div class="status-bar">
        <div class="status-item"><div class="status-dot"></div><span>실시간 동기화</span></div>
        <div class="status-item"><span>📅 <span id="currentDate"></span></span></div>
        <div class="status-item"><span>⏰ <span id="currentTime"></span></span></div>
        <div class="status-item">
          <span>👤 <select id="userRole" onchange="switchUserRole()" style="padding:2px 5px;border-radius:4px;">
            <option value="secretary">비서 모드</option>
            <option value="ceo">대표님 모드</option>
          </select></span>
        </div>
        <div class="status-item"><span>📌 열린 요청: <strong id="openRequests">0</strong>건</span></div>
      </div>
    </div>

    <!-- 긴급/서명/예약 입력 패널 -->
    <div class="urgent-panel">
      <h3 style="margin-bottom:15px;" id="panelTitle">📤 긴급 전달</h3>
      <div class="request-types">
        <button class="request-type-btn active" onclick="setRequestType('urgent', event)">🚨 긴급 요청</button>
        <button class="request-type-btn" id="signBtn" onclick="setRequestType('sign', event)">✍️ 서명 요청</button>
        <button class="request-type-btn" onclick="setRequestType('reserve', event)">📅 예약/일정</button>
      </div>
      <div style="background:rgba(255,255,255,.2);padding:10px;border-radius:8px;margin:10px 0;font-size:13px;">
        💡 <strong>현재:</strong> <span id="currentUserDisplay">비서 모드</span>
        <div id="reserveGuide" style="display:none;margin-top:5px;padding-top:5px;border-top:1px solid rgba(255,255,255,.3);">
          📅 <strong>예약/일정 사용법:</strong><br/>
          • 대표님: 예약 요청 입력 (예: "내일 3시 A사 미팅 잡아주세요")<br/>
          • 비서: 예약 완료 후 결과 입력 (예: "A사 미팅 15시 확정")
        </div>
      </div>
      <textarea class="message-input" id="urgentMessage" placeholder="긴급하게 전달할 내용을 입력하세요..."></textarea>
      <div class="action-buttons">
        <button class="btn btn-send" onclick="sendRequest()">
          <span>📤</span><span id="sendButtonText">슬랙대시보드봇으로 전송</span>
        </button>
      </div>
    </div>

    <div class="main-grid">
      <div>
        <!-- 오늘의 미팅 -->
        <div class="card" style="margin-bottom:25px;">
          <div class="card-header">
            <div class="card-title">📅 오늘의 미팅</div>
            <div style="display:flex;align-items:center;gap:10px;">
              <span class="badge" id="meetingCount">0건</span>
              <span style="font-size:12px;color:#999;">💜 슬랙 #미팅-현황</span>
            </div>
          </div>
          <div class="meeting-list" id="meetingList">
            <div style="text-align:center;color:#999;">슬랙 채널에서 미팅 정보를 불러오는 중...</div>
          </div>
          <div style="margin-top:10px;padding:10px;background:#f0f0f0;border-radius:8px;font-size:12px;color:#666;">💡 미팅 정보는 슬랙 #미팅-현황 채널에서 자동으로 가져옵니다</div>
        </div>

        <!-- 대시보드 채팅 (로컬 저장) -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">💬 대시보드 채팅</div>
            <span class="badge">실시간</span>
          </div>
          <div style="background:#f0f8ff;padding:10px;border-radius:8px;margin-bottom:15px;font-size:13px;">📌 <strong>대화 내역:</strong> 대시보드에서 이루어진 대화만 표시됩니다 (보관: 최근 7일)</div>
          <div class="chat-container" id="chatContainer"><div style="text-align:center;color:#999;">대화 내역을 불러오는 중...</div></div>
          <div class="chat-input-group">
            <input type="text" class="chat-input" id="chatInput" placeholder="메시지 입력…" onkeypress="if(event.key==='Enter') sendChat()" />
            <button class="btn btn-send" onclick="sendChat()" style="padding:10px 20px;">전송</button>
          </div>
        </div>
      </div>

      <!-- 오른쪽: 파일 & 요청 -->
      <div>
        <!-- 파일 업로드 (Drive 공유) -->
        <div class="card" style="margin-bottom:25px;">
          <div class="card-header"><div class="card-title">📁 파일 공유</div></div>
          <div class="file-upload-area" onclick="document.getElementById('fileInput').click()">
            <div>📎 클릭하여 파일 선택</div>
            <div style="font-size:12px;color:#999;margin-top:5px;">또는 파일을 여기로 드래그</div>
          </div>
          <input type="file" id="fileInput" style="display:none;" onchange="handleFileSelect(event)" />
          <div class="file-list" id="fileList"></div>
        </div>

        <!-- 업무 지시 / 요청 현황 -->
        <div class="card">
          <div class="card-header"><div class="card-title">🧭 업무 지시</div></div>
          <div class="request-list" id="requestList"><div style="text-align:center;color:#999;">요청 내역이 없습니다</div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"><span id="toastIcon">✅</span><span id="toastMessage">메시지</span></div>

  <script>
    // ===== CONFIG =====
    const CONFIG = {
      GAS_URL: 'https://script.google.com/a/macros/cafe24corp.com/s/AKfycbxKdSjsv-9Nn8rH-MG1A4KXmUsqoeAAOe8T9EjrnNKQgX9M1-DrswWZANq0AcgTmwiSPA/exec', // 실제 배포 URL
      TOKEN: '7c1e4a9fdb2e4930b58c6e91d7a4b235',
      AUTO_REFRESH: 30000,
      MEETING_REFRESH: 60000
    };

    let currentRequestType = 'urgent';
    let selectedFile = null;
    let currentUser = localStorage.getItem('userRole') || 'secretary';
    // 최근 업로드 파일(자동 포함용)
    let lastUploaded = null;

    document.addEventListener('DOMContentLoaded', function(){
      document.getElementById('userRole').value = currentUser;
      updateUserInterface();
      updateDateTime();
      syncMeetingsFromSlack();
      loadMeetings();
      loadChatHistory();
      countOpenRequests();
      loadRecentRequests();

      setInterval(() => {
        loadChatHistory();
        countOpenRequests();
        loadRecentRequests();
        // 요청 상태의 슬랙 리액션 동기화 (👀/✅)
        callGAS('GET','requests/refresh').catch(()=>{});
      }, CONFIG.AUTO_REFRESH);

      setInterval(() => {
        syncMeetingsFromSlack();
        loadMeetings();
      }, CONFIG.MEETING_REFRESH);

      setInterval(updateDateTime, 1000);
    });

   // ===== JSONP ONLY callGAS =====
  function callGAS(method, path, data = {}) {
    return new Promise((resolve, reject) => {
      const cb = 'cb_' + Date.now() + '_' + Math.floor(Math.random() * 1e9);
      let settled = false;

      // 공통 정리 함수
      function cleanup() {
        try { delete window[cb]; } catch(_) {}
        try { if (script && script.parentNode) script.parentNode.removeChild(script); } catch(_) {}
      }

      const timeout = setTimeout(() => {
        if (settled) return;
        settled = true;
        cleanup();
        reject(new Error('Request timeout'));
      }, 30000);

      window[cb] = (res) => {
        if (settled) return;
        settled = true;
        clearTimeout(timeout);
        cleanup();
        resolve(res);
      };

      let url = `${CONFIG.GAS_URL}?path=${encodeURIComponent(path)}&token=${encodeURIComponent(CONFIG.TOKEN)}&callback=${cb}`;
      if (method === 'POST') {
        url += `&method=POST&body=${encodeURIComponent(JSON.stringify(data))}`;
      }

      const script = document.createElement('script');
      script.src = url;
      script.onerror = () => {
        if (settled) return;
        settled = true;
        clearTimeout(timeout);
        cleanup();
        reject(new Error('Script load error'));
      };
      document.body.appendChild(script);
    });
  }
    
    // ===== Utils =====
    function showToast(icon, msg){ const t=document.getElementById('toast'); document.getElementById('toastIcon').textContent=icon; document.getElementById('toastMessage').textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }
    function updateDateTime(){ const now=new Date(); document.getElementById('currentDate').textContent=now.toLocaleDateString('ko-KR',{month:'long',day:'numeric',weekday:'short'}); document.getElementById('currentTime').textContent=now.toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'}); }

    // 1899 방지: HH:mm로 정규화
    function toHHMM(t){ if(!t) return ''; if(typeof t==='string'){ const m=t.match(/(\d{1,2}):(\d{2})/); return m ? m[1].padStart(2,'0')+':'+m[2] : t; } try{ const d=new Date(t); if(!isNaN(d)) return d.toTimeString().slice(0,5); }catch(_){} return String(t); }

    // ===== UI =====
    function switchUserRole(){ currentUser=document.getElementById('userRole').value; localStorage.setItem('userRole', currentUser); updateUserInterface(); showToast('👤', `${currentUser==='ceo'?'대표님':'비서'} 모드로 전환되었습니다`); }
    function updateUserInterface(){ const isCEO=currentUser==='ceo'; document.getElementById('panelTitle').textContent=isCEO?'📤 비서에게 전달':'📤 대표님께 전달'; document.getElementById('currentUserDisplay').textContent=isCEO?'대표님 모드':'비서 모드'; document.getElementById('sendButtonText').textContent=isCEO?'비서에게 전송 (슬랙대시보드봇)':'대표님께 전송 (슬랙대시보드봇)'; document.getElementById('urgentMessage').placeholder=isCEO?'비서에게 전달할 내용을 입력하세요...':'대표님께 전달할 내용을 입력하세요...'; const signBtn=document.getElementById('signBtn'); if(isCEO){signBtn.style.opacity='0.5';signBtn.style.cursor='not-allowed';signBtn.disabled=true;}else{signBtn.style.opacity='1';signBtn.style.cursor='pointer';signBtn.disabled=false;} }
    function setRequestType(type, ev){ if(currentUser==='ceo' && type==='sign'){ showToast('⚠️','서명 요청은 비서만 사용 가능합니다'); return;} currentRequestType=type; document.querySelectorAll('.request-type-btn').forEach(btn=>btn.classList.remove('active')); if(ev && ev.target) ev.target.classList.add('active'); document.getElementById('reserveGuide').style.display = (type==='reserve'?'block':'none'); }

    // ===== Meetings =====
    async function syncMeetingsFromSlack(){ try{ const r=await callGAS('GET','meetings/refresh'); if (r.inserted>0 || r.removed>0) showToast('📅',`미팅 업데이트: ${r.inserted} 추가, ${r.removed} 제거`); await loadMeetings(); }catch(e){ console.error('슬랙 미팅 동기화 실패:', e);} }
    async function loadMeetings(){ try{ const data=await callGAS('GET','meetings/list'); const list=document.getElementById('meetingList'); const items=data.items||[]; document.getElementById('meetingCount').textContent=items.length+'건'; if(items.length===0){list.innerHTML='<div style="text-align:center;color:#999;">오늘 미팅이 없습니다</div>';return} items.sort((a,b)=> toHHMM(a.start_time).localeCompare(toHHMM(b.start_time)) ); const now=new Date(); const curMin=now.getHours()*60+now.getMinutes(); list.innerHTML=items.map(m=>{ const hhmm=toHHMM(m.start_time); let status='',cls=''; if(hhmm){ const [h,mi]=hhmm.split(':').map(Number); const mt=h*60+mi; if(mt<curMin-60){status='✅ 완료';cls='completed'} else if(Math.abs(mt-curMin)<30){status='🔄 진행중';cls='ongoing'} else if(mt>curMin){status='⏰ 예정';cls='upcoming'} } return `<div class="meeting-item ${cls}"><div class="meeting-time">${hhmm||'시간 미정'} ${status}</div><div class="meeting-title">${m.title||''}</div><div class="meeting-detail">📍 ${m.location||'장소 미정'} ${m.link?`| <a href="${m.link}" target="_blank">🔗 링크</a>`:''}</div></div>` }).join(''); }catch(e){ console.error('미팅 로드 실패:', e);} }

    // ===== Dashboard Chat (Local) =====
    async function loadChatHistory(){ try{ const data=await callGAS('GET','chat/local/history'); const container=document.getElementById('chatContainer'); const items=data.items||[]; if(items.length===0){ container.innerHTML='<div style="text-align:center;color:#999;">대화 내역이 없습니다</div>'; return; } container.innerHTML=items.map(msg=>{ const mine=(msg.from===currentUser); const klass=mine?'sent':'received'; const ts=new Date(msg.timestamp).toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'}); return `<div class="chat-message ${klass}"><div>${msg.text||''}</div><div class="chat-time">${ts}</div></div>`; }).join(''); container.scrollTop=container.scrollHeight; }catch(err){ console.error('대시보드 채팅 로드 실패:', err); } }
    async function sendChat(){ const input=document.getElementById('chatInput'); const text=input.value.trim(); if(!text) return; try{ input.disabled=true; await callGAS('POST','chat/local/send',{from:currentUser, text}); input.value=''; setTimeout(loadChatHistory,300); }catch(err){ showToast('❌','전송 실패'); }finally{ input.disabled=false; input.focus(); } }

    // ===== Requests =====
    async function countOpenRequests(){ try{ const d=await callGAS('GET','requests/count'); document.getElementById('openRequests').textContent=d.open||0; }catch(e){ console.error('요청 수 확인 실패:', e);} }
    async function loadRecentRequests(){ try{ const d=await callGAS('GET','requests/list'); const list=document.getElementById('requestList'); const items=d.items||[]; if(items.length===0){ list.innerHTML='<div style="text-align:center;color:#999;">내역이 없습니다</div>'; return; } list.innerHTML=items.slice(0,12).map(req=>{ let icon='📌'; if(req.type==='urgent') icon='🚨'; else if(req.type==='sign') icon='✍️'; else if(req.type==='reserve') icon='📅'; else if(req.type==='task') icon='🧭'; let statusClass='status-open', statusLabel='대기'; if(req.status==='doing'){ statusClass='status-doing'; statusLabel='확인'; } else if(req.status==='done'){ statusClass='status-done'; statusLabel='완료'; } const time=new Date(req.timestamp).toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'}); const from=req.from==='ceo'?'👤 대표님':'👩‍💼 비서'; const title=(req.message||'').substring(0,30)+((req.message&&req.message.length>30)?'...':''); return `<div class="request-item"><div><div style="font-weight:600;">${icon} ${title}</div><div style="font-size:12px;color:#999;margin-top:5px;">${from} • ${time}</div></div><span class="request-status ${statusClass}">${statusLabel}</span></div>`; }).join(''); }catch(e){ console.error('요청 로드 실패:', e);} }
    async function sendRequest(){
      const textarea = document.getElementById('urgentMessage');
      const message = textarea.value.trim();
      if(!message){
        showToast('⚠️','메시지를 입력해주세요');
        return;
      }
      try{
        showToast('⏳','전송 중...');
        await callGAS('POST','requests/create',{
          type: currentRequestType,
          from: currentUser,
          message,
          priority: currentRequestType==='urgent' ? 'high' : 'normal'
        });
        textarea.value = '';
        const recipient = currentUser==='ceo' ? '비서' : '대표님';
        showToast('✅', `${recipient}에게 슬랙대시보드봇으로 전송 완료!`);
        countOpenRequests();
        loadRecentRequests();
        setTimeout(loadChatHistory, 800);
      }catch(err){
        showToast('❌','전송 실패: '+err.message);
      }
    }

    
    <!-- ===== Files (Drive upload) ===== -->
     function handleFileSelect(ev){
      const file = ev.target.files[0];
      if(!file) return;
      selectedFile = file;
      document.getElementById('fileList').innerHTML = `
        <div class="file-item">
          <span>📄</span><span>${file.name}</span>
          <button onclick="uploadSelectedFile()" class="btn" style="padding:5px 10px;font-size:12px;">업로드</button>
        </div>`;
    }
    
   
    const LARGE_THRESHOLD = 100 * 1024; // 100KB 이상은 POST(no-cors) 경로

    async function uploadSelectedFile(){
      if(!selectedFile) return;

      try{
        showToast('⏳','파일 업로드 중...');
        const reader = new FileReader();
        reader.onload = async (e) => {
          const base64 = e.target.result.split(',')[1];
          const payload = {
            filename: selectedFile.name,
            mimeType: selectedFile.type || 'application/octet-stream',
            base64,
            uploaded_by: currentUser
          };

          // 고유 식별자(폴링에서 찾기 위함)
          const upid = 'UP-' + Date.now() + '-' + Math.random().toString(36).slice(2,8);
          payload.related_request_id = upid;

          let url = null;

          if (selectedFile.size <= LARGE_THRESHOLD) {
            // --- 작은 파일: JSONP로 바로 업로드 ---
            const result = await callGAS('POST','files/upload', payload);
            if(!result || result.ok === false || !result.url){
              console.error('upload failed(JSONP)', result);
              showToast('❌','업로드 실패: ' + (result && result.error ? result.error : '서버 응답 없음'));
              return;
            }
            url = result.url;

          } else {
            // --- 큰 파일: 진짜 POST(no-cors) 보내고 → list를 폴링 ---
            try{
              await fetch(`${CONFIG.GAS_URL}?path=files/upload`, {
                method: 'POST',
                mode: 'no-cors',                // 응답은 못 읽지만 서버에는 전달됨
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({...payload, token: CONFIG.TOKEN}) // _auth 통과
              });
            }catch(_){ /* no-cors라 에러 무시 */ }

            // 업로드 반영될 때까지 files/list로 폴링(최대 10초)
            const started = Date.now();
            while(Date.now() - started < 10000){ // 10초
              await new Promise(r=>setTimeout(r, 1200));
              const data = await callGAS('GET','files/list');
              const items = (data && data.items) ? data.items : [];
              const hit = items.find(it => it.related === upid);
              if (hit && hit.url) { url = hit.url; break; }
            }
            if(!url){
              showToast('❌','업로드 확인 실패(시간초과)');
              return;
            }
          }

          // 성공 처리
          showToast('✅','파일 업로드 완료!');
          const ta = document.getElementById('urgentMessage');
          const line = `\n📎 파일: ${url}`;
          if(!ta.value.includes(url)) ta.value += line;

          document.getElementById('fileList').innerHTML = '';
          selectedFile = null;
          if (typeof loadSharedFiles === 'function') loadSharedFiles();
        };
        reader.readAsDataURL(selectedFile);

      }catch(err){
        console.error('upload error', err);
        showToast('❌','업로드 실패');
      }
    }
    </script>
    </body>
    </html>
